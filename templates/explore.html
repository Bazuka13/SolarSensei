{% extends "layout.html" %}
{% block content %}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
    /* 1. NEW GLOW STYLE (Amber Theme) */
    .glow-box {
        background: rgba(3, 7, 18, 0.85); /* Thoda dark background taaki text pop kare */
        backdrop-filter: blur(12px);
        border: 1px solid rgba(250, 204, 21, 0.3); /* Amber Border */
        box-shadow: 0 0 20px rgba(250, 204, 21, 0.1); /* Soft Amber Glow */
        transition: all 0.3s ease;
    }
    .glow-box:hover {
        border-color: rgba(250, 204, 21, 0.6);
        box-shadow: 0 0 30px rgba(250, 204, 21, 0.2);
    }

    /* Marker Pulse */
    .custom-marker {
        background-color: #facc15;
        border: 3px solid #000;
        border-radius: 50%;
        box-shadow: 0 0 15px #facc15;
        animation: pulse-marker 1.5s infinite;
    }
    @keyframes pulse-marker {
        0% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7); }
        70% { box-shadow: 0 0 0 15px rgba(250, 204, 21, 0); }
        100% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0); }
    }
</style>

<div class="relative h-[85vh] w-full rounded-[40px] overflow-hidden border border-amber-500/20 shadow-[0_0_40px_rgba(0,0,0,0.5)]">
    
    <div id="map" class="h-full w-full bg-[#1a1a1a]"></div>

    <div class="absolute top-6 left-6 z-[1000] flex gap-2">
        <input type="text" id="map-search" placeholder="Search city..." class="glow-box text-white px-6 py-3 rounded-full w-64 outline-none focus:bg-black/80 placeholder-gray-400 text-sm">
        <button onclick="searchLocation()" class="bg-amber-500 text-black px-4 py-3 rounded-full font-bold hover:bg-amber-400 transition-all shadow-[0_0_15px_rgba(250,204,21,0.4)]">üîç</button>
    </div>

    <div id="snapshot-panel" class="absolute top-6 right-6 w-[380px] glow-box rounded-[32px] p-8 z-[1000] translate-x-[120%] transition-transform duration-500 ease-out">
        
        <div id="panel-loader" class="hidden flex flex-col items-center justify-center py-10 space-y-4">
            <div class="w-10 h-10 border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-xs font-bold text-amber-500 animate-pulse">Scanning Satellite Data...</p>
        </div>

        <div id="panel-content">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h3 class="text-2xl font-black text-white leading-tight" id="snap-location">--</h3>
                    <p class="text-[10px] font-mono text-gray-400 mt-1" id="snap-coords">--</p>
                </div>
                <button onclick="closeSnapshot()" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition-all">‚úï</button>
            </div>

            <div class="space-y-4">
                <div class="bg-white/5 p-5 rounded-2xl border border-white/10 flex justify-between items-center hover:border-amber-500/30 transition-colors">
                    <div>
                        <p class="text-[10px] text-gray-500 uppercase font-black tracking-widest mb-1">Solar Flux</p>
                        <p class="text-3xl font-black text-white"><span id="snap-flux">--</span> <span class="text-xs font-normal text-gray-400">kWh/m¬≤</span></p>
                    </div>
                    <div class="text-right">
                        <div class="text-amber-500 text-2xl">‚òÄÔ∏è</div>
                    </div>
                </div>
                
                <div class="bg-white/5 p-5 rounded-2xl border border-white/10 hover:border-amber-500/30 transition-colors">
                    <div class="flex justify-between items-end mb-2">
                        <p class="text-[10px] text-gray-500 uppercase font-black tracking-widest">Suitability</p>
                        <span class="text-sm font-bold text-white" id="snap-tag">--</span>
                    </div>
                    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                        <div id="snap-bar" class="h-full bg-gradient-to-r from-amber-600 to-amber-400 w-[0%]"></div>
                    </div>
                    <p class="text-[10px] text-gray-400 mt-2 text-right"><span id="snap-score">0</span>% Potential</p>
                </div>

                <div class="bg-gradient-to-br from-amber-500/10 to-amber-500/5 border border-amber-500/30 p-6 rounded-[24px] text-center relative overflow-hidden shadow-[inset_0_0_20px_rgba(250,204,21,0.05)]">
                    <p class="text-xs text-amber-500 font-bold uppercase tracking-wider mb-2">Power Yield (per 1kW)</p>
                    <h4 class="text-4xl font-black text-amber-400"><span id="snap-gen">--</span> <span class="text-sm text-white/60">kWh/yr</span></h4>
                </div>
                
                <button id="analyze-btn" class="w-full py-4 bg-amber-500 text-black rounded-xl font-black text-sm hover:bg-amber-400 hover:scale-[1.02] active:scale-95 transition-all shadow-[0_0_20px_rgba(250,204,21,0.3)] flex items-center justify-center gap-2">
                    <span>Generate Full Report</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                </button>
            </div>
        </div>
    </div>

    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 glow-box px-8 py-3 rounded-full z-[900] flex items-center gap-6">
        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></span><span class="text-xs font-bold text-gray-300">Excellent (>5.0)</span></div>
        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(250,204,21,0.5)]"></span><span class="text-xs font-bold text-gray-300">Good (4.0-5.0)</span></div>
        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-orange-500 shadow-[0_0_10px_rgba(249,115,22,0.5)]"></span><span class="text-xs font-bold text-gray-300">Moderate (<4.0)</span></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}